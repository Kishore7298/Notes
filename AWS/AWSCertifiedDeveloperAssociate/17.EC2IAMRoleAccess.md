# ğŸ§  IAM Roles for EC2 Instances

IAM Roles allow EC2 instances to securely access AWS services **without embedding credentials** inside the instance.

---

## âš™ï¸ Connecting to the Instance

You can connect to your EC2 instance using:

* **SSH** (from terminal / PuTTY)
* **EC2 Instance Connect** (via web browser)

Once connected, youâ€™ll be logged in as:

```bash
ec2-user@<private-ip>
```

You can run standard Linux commands, e.g.:

```bash
ping google.com
clear
```

---

## ğŸ’¡ AWS CLI on EC2

Amazon Linux AMI comes **preinstalled with AWS CLI**.

Example command:

```bash
aws iam list-users
```

If you run this before configuring credentials, youâ€™ll see:

```
Unable to locate credentials
```

You may be tempted to use:

```bash
aws configure
```

â€¦but **this is a bad idea** âŒ

---

## ğŸš« Why Not Use `aws configure` Inside EC2?

Using `aws configure` stores **Access Key ID** and **Secret Access Key** locally inside your instance.
This is **very insecure**, because:

* Anyone with access to the instance can retrieve your credentials.
* Keys can be misused across other AWS resources.

> ğŸ”¥ **Rule of Thumb:**
> Never enter IAM access keys directly into an EC2 instance.

---

## âœ… Correct Way â€” Use IAM Roles

### ğŸ”¹ Step 1: Create an IAM Role

* Go to **IAM â†’ Roles**.
* Create a role for **EC2 service**.
* Attach appropriate policies (e.g., `IAMReadOnlyAccess`).
* Example Role: `DemoRoleForEC2`.

### ğŸ”¹ Step 2: Attach Role to EC2 Instance

In the **EC2 Management Console**:

```
Actions â†’ Security â†’ Modify IAM Role
```

Select your role (e.g., `DemoRoleForEC2`) â†’ **Save**.

Youâ€™ll now see it under the **Security tab**:

```
IAM Role: DemoRoleForEC2
```

---

## ğŸ§© Testing Role Access

Run the following again:

```bash
aws iam list-users
```

You should now get a valid IAM response âœ…
(no need to use `aws configure`).

If you **detach** the IAM policy or role:

```bash
AccessDenied
```

â†’ confirms that permissions are managed via the IAM role.

---

## ğŸ” Policy Propagation Delay

When re-attaching or updating IAM policies:

* It can take a few seconds for the permissions to take effect.
* Retry the command after a brief wait.

---

## ğŸ§­ Key Takeaways

* âŒ Never store AWS credentials on EC2.
* âœ… Always use **IAM Roles** to grant permissions.
* ğŸ§± IAM Roles attach to EC2 at the instance level.
* ğŸ”„ Policy updates can take time to propagate.
* ğŸ§  Example policy: `IAMReadOnlyAccess` allows EC2 to read IAM data.

---

**Prev**: [EC2 SSH](16.EC2SSH.md) | **Next**: [EC2 Instance Pricing](18.EC2InstancePricing.md) | [Index](../INDEX.md)
